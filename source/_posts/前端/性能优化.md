---
title: 前端性能优化
date: 2023-09-11 16:18:39
tags:
	- 性能优化
categories:
	- 前端
---

## 大方向

前端性能优化可以从以下几个方面入手：
- 加载优化
- 执行优化
- 渲染优化
- 脚本优化
- 代码优化
### 加载优化

减少HTTP请求、缓存资源、压缩代码、无阻塞、首屏加载、按需加载、预加载、压缩图像、减少Cookie、避免重定向、异步加载第三方资源。

### 执行优化

CSS写在头部，JS写在尾部并异步、避免img、iframe等的src为空、尽量避免重置图像大小、图像尽量避免使用DataURL

### 渲染优化

设置viewport、减少DOM节点、优化动画、优化高频事件、GPU加速

### 样式优化

避免在HTML中书写style、避免CSS表达式、移除CSS空规则、正确使用display：display、不滥用float等

### 脚本优化

减少重绘和回流、缓存DOM选择与计算、缓存.length的值、尽量使用事件代理、尽量使用id选择器、touch事件优化.

## 加载优化

1. 减少http请求，尽量减少页面的请求数。（首次加载同时请求数不能超过4个）

- 合并CSS与JS
- 使用CSS雪碧图

2. 缓存资源：使用缓存可减少向服务器的请求数，节省加载时间，所有静态资源都要在服务器端设置缓存，并且尽量使用长缓存(使用时间戳更新缓存)。
- 缓存一切可缓存的资源
- 使用长缓存
- 使用外联的样式和脚本
3. 压缩代码：减少资源大小可加快网页显示速度，对代码进行压缩，并在服务器端设置GZip
- 压缩代码(多余的缩进、空格和换行符)
- 启用Gzip
4. 无阻塞：头部内联的样式和脚本会阻塞页面的渲染，样式放在头部并使用link方式引入，脚本放在尾部并使用异步方式加载。
5. 首屏加载：首屏快速显示可大大提升用户对页面速度的感知，应尽量针对首屏的快速显示做优化
6. 按需加载：将不影响首屏的资源和当前屏幕不用的资源放到用户需要时才加载，可大大提升显示速度和降低总体流量(按需加载会导致大量重绘，影响渲染性能)
- 按需加载
- 滚动加载
- Media Query加载
7. 预加载：大型资源页面可使用Loading，资源加载完成后再显示页面，但加载时间过长，会造成用户流失
- 可感知Loading：进入页面时Loading
- 不可感知Loading：提前加载下一页
8. 压缩图像：使用图像时选择最合适的格式和大小，然后使用工具压缩，同时在代码中用srcset来按需显示过度压缩图像大小影响图像显示效果。
- 使用TinyJpg和TinyPng压缩图像
- 使用CSS3、SVG、IconFont代替图像
- 使用img的srcset按需加载图像
- 选择合适的图像：webp优于jpg，png8优于gif
- 选择合适的大小：首次加载不大于1014kb、不 宽于640px，
	PS切图时D端图像保存质量为80，M端图像保存质量为60
9. 减少cookie:cookie影响加载速度，静态资源域名不使用cookie.
10. 避免重定向：重定向会影响加载速度，在服务器正确设置避免重定向
11. 异步加载第三方资源：第三方资源不可控会影响页面的加载和显示，要异步加载第三方资源。

## 执行优化

1. css写在头部，js写在尾部并异步。
2. 避免img、iframe等的src为空：空src会重新加载当前页面，影响速度和效率。
3. 尽量避免重置图像大小：多次重置图像大小会引发图像的多次重绘，影响性能
4. 图像尽量避免使用DataURL：DataURL图像没有使用图像的压缩算法，文件会变大，并且要解码后再渲染，加载慢耗时长。

## 渲染优化
1. 设置viewport:HTML的viewport可加速页面的渲染
2. 减少DOM节点：DOM节点太多影响页面的渲染，尽量减少DOM节点。

3. 优化动画
- 尽量使用css3动画
- 合理使用requestAnimationFrame动画代替setTimeout.
- 适当使用canvas动画：5个元素以内使用css动画，5个元素使用canvas动画，iOS8+可使用WebGL动画。

4. 优化高频事件：scroll、touchmove等事件可导致多次渲染。
- 函数节流
- 函数防抖
- 使用requestAnimationFrame监听帧变化：使得在正确的时间进行渲染
- 增加响应变化的时间间隔：减少重绘次数

5. GPU加速:使用某些html5标签和css3属性触发GPU渲染，请合理使用(过渡使用会引发手机耗电量增加)。
- html标签：video,canvas，webgl
- css属性，opacity,transform，transition

持续更新中。。。

