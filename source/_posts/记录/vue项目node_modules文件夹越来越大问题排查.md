---
title: vue项目node_modules文件夹越来越大问题排查
date: 2024-06-24 10:57:15
tags:
	- 记录
mainColor: #d4a5e7
---

<!-- 文章目录
一、排查node_modules包为什么会越来越大
-->

## 事件背景
> 公司项目比较多，所以电脑本地下载的项目也比较多，然后硬盘空间越来越不够用，就把一些不经常改动的项目删除了，并且把一些系统缓存都清掉了，但是效果并不明显，依旧不够用。有一项目比较大，就怀疑是这个项目的问题。在某一次删除node_modules重装时，竟然有夸张的17+个G

## 排查过程

- 现象：
删除node_modules,重新安装，只有几百兆的大小。运行npm run dev命令之后，会立即增加几十兆，重复多次运行，发现未增加空间。修改代码，实时编译之后，发现空间增加5兆左右，只要修改一次就增加一次。

- 尝试解决方案：

替换包管理工具，yarn 发现问题依旧存在。
考虑是不是缓存引起

查阅vue-cli官网，发现官网有这么一句话。

![配置](https://gitee.com/syy1101/image/raw/master/5a25879f38c24716b9b9cd08d900a37b.png)
至此，.cache文件夹进入视野。

是不是这个loader引起的呢？是不是去除这个loader就能解决该问题。
在vue.config.js中的chainWebpack中配置如下代码：

```javascript
module.exports = {
  chainWebpack(config) {
      config.module.rule('vue').uses.store.delete('cache-loader');
      config.module.rule('js').uses.store.delete('cache-loader');
   }
},
```

代码打印，确实已删除了`loader`，但是现象依旧存在。
会不会是其他插件引起的，仔细观察后发现，`.cache`中的`compression-webpack-plugin`每次增加的空间，正好是整个node_modules增加的空间。
查看`vue.config.js`，插件的配置确实存在`compression-webpack-plugin`，且没有区分环境。
直接先注释，运行项目，观察现象消失。
至此，问题终于定位到了。

## 解决方案

`compression-webpack-plugin`，压缩资源，配合nginx加速资源加载，优化体验。
解决方式：针对该插件直接区分下环境，只有在生产打包的时候，进行启用即可。
